### Webhook Testing with VS Code REST Client Extension
### Install: https://marketplace.visualstudio.com/items?itemName=humao.rest-client

@baseUrl = http://localhost:3000
@webhookEndpoint = {{baseUrl}}/api/webhooks/data-sync
@bulkSyncEndpoint = {{baseUrl}}/api/webhooks/data-sync/bulk-sync

###############################################################################
# HEALTH CHECK
###############################################################################

### Health Check
GET {{webhookEndpoint}}
Accept: application/json

###############################################################################
# HR EMPLOYEES - INDIVIDUAL WEBHOOKS
###############################################################################

### 1. Insert New Employee
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "INSERT",
  "timestamp": "2025-01-17T14:00:00Z",
  "data": {
    "employeeNumber": "TEST-001",
    "firstName": "John",
    "middleName": "Doe",
    "lastName": "Smith",
    "phone": "0999-123-4567",
    "position": "Driver",
    "departmentId": 1,
    "department": "Operations"
  }
}

### 2. Update Existing Employee
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "UPDATE",
  "timestamp": "2025-01-17T14:05:00Z",
  "data": {
    "employeeNumber": "TEST-001",
    "firstName": "John",
    "middleName": "Michael",
    "lastName": "Smith",
    "phone": "0999-999-9999",
    "position": "Senior Driver",
    "departmentId": 1,
    "department": "Operations"
  }
}

### 3. Delete Employee
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "DELETE",
  "timestamp": "2025-01-17T14:10:00Z",
  "data": {
    "employeeNumber": "TEST-001"
  }
}

###############################################################################
# HR PAYROLL - INDIVIDUAL WEBHOOKS
###############################################################################

### 4. Insert Payroll Record (Complex with Nested Data)
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_payroll",
  "action": "INSERT",
  "timestamp": "2025-01-17T14:15:00Z",
  "data": {
    "employeeNumber": "TEST-002",
    "firstName": "Jane",
    "middleName": "Marie",
    "lastName": "Doe",
    "suffix": null,
    "employeeStatus": "ACTIVE",
    "hiredate": "2024-01-15",
    "terminationDate": null,
    "basicRate": "12000.00",
    "position": {
      "positionName": "Conductor",
      "department": {
        "departmentName": "Operations"
      }
    },
    "attendances": [
      {
        "date": "2025-01-15",
        "status": "PRESENT"
      },
      {
        "date": "2025-01-16",
        "status": "PRESENT"
      },
      {
        "date": "2025-01-17",
        "status": "ABSENT"
      }
    ],
    "benefits": [
      {
        "value": "2000.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2024-01-15",
        "endDate": null,
        "isActive": true,
        "benefitType": {
          "name": "Transportation Allowance"
        }
      },
      {
        "value": "1500.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2024-01-15",
        "endDate": null,
        "isActive": true,
        "benefitType": {
          "name": "Meal Allowance"
        }
      }
    ],
    "deductions": [
      {
        "type": "LOAN",
        "value": "500.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2024-02-01",
        "endDate": null,
        "isActive": true,
        "deductionType": {
          "name": "Company Loan"
        }
      },
      {
        "type": "SSS",
        "value": "300.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2024-01-15",
        "endDate": null,
        "isActive": true,
        "deductionType": {
          "name": "SSS Contribution"
        }
      }
    ]
  }
}

### 5. Update Payroll Record
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_payroll",
  "action": "UPDATE",
  "timestamp": "2025-01-17T14:20:00Z",
  "data": {
    "employeeNumber": "TEST-002",
    "firstName": "Jane",
    "middleName": "Marie",
    "lastName": "Doe",
    "suffix": null,
    "employeeStatus": "ACTIVE",
    "hiredate": "2024-01-15",
    "terminationDate": null,
    "basicRate": "13500.00",
    "position": {
      "positionName": "Senior Conductor",
      "department": {
        "departmentName": "Operations"
      }
    },
    "attendances": [
      {
        "date": "2025-01-15",
        "status": "PRESENT"
      },
      {
        "date": "2025-01-16",
        "status": "PRESENT"
      },
      {
        "date": "2025-01-17",
        "status": "PRESENT"
      }
    ],
    "benefits": [
      {
        "value": "2500.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2025-01-17",
        "endDate": null,
        "isActive": true,
        "benefitType": {
          "name": "Transportation Allowance"
        }
      }
    ],
    "deductions": [
      {
        "type": "LOAN",
        "value": "500.00",
        "frequency": "MONTHLY",
        "effectiveDate": "2024-02-01",
        "endDate": null,
        "isActive": true,
        "deductionType": {
          "name": "Company Loan"
        }
      }
    ]
  }
}

### 6. Delete Payroll Record
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_payroll",
  "action": "DELETE",
  "timestamp": "2025-01-17T14:25:00Z",
  "data": {
    "employeeNumber": "TEST-002"
  }
}

###############################################################################
# OPERATIONS BUS TRIPS - INDIVIDUAL WEBHOOKS
###############################################################################

### 7. Insert Bus Trip Assignment
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "op_bus_trips",
  "action": "INSERT",
  "timestamp": "2025-01-17T14:30:00Z",
  "data": {
    "assignment_id": 99999,
    "bus_trip_id": 88888,
    "bus_route": "Cebu-Manila",
    "is_revenue_recorded": false,
    "is_expense_recorded": false,
    "date_assigned": "2025-01-17",
    "trip_fuel_expense": "5000.00",
    "trip_revenue": "25000.00",
    "assignment_type": "BOUNDARY",
    "assignment_value": "8000.00",
    "payment_method": "CASH",
    "driver_name": "John Smith",
    "conductor_name": "Jane Doe",
    "bus_plate_number": "ABC-1234",
    "bus_type": "REGULAR",
    "body_number": "BUS-TEST-001"
  }
}

### 8. Update Bus Trip (Mark Revenue Recorded)
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "op_bus_trips",
  "action": "UPDATE",
  "timestamp": "2025-01-17T14:35:00Z",
  "data": {
    "assignment_id": 99999,
    "bus_trip_id": 88888,
    "bus_route": "Cebu-Manila",
    "is_revenue_recorded": true,
    "is_expense_recorded": false,
    "date_assigned": "2025-01-17",
    "trip_fuel_expense": "5000.00",
    "trip_revenue": "25000.00",
    "assignment_type": "BOUNDARY",
    "assignment_value": "8000.00",
    "payment_method": "CASH",
    "driver_name": "John Smith",
    "conductor_name": "Jane Doe",
    "bus_plate_number": "ABC-1234",
    "bus_type": "REGULAR",
    "body_number": "BUS-TEST-001"
  }
}

### 9. Delete Bus Trip
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "op_bus_trips",
  "action": "DELETE",
  "timestamp": "2025-01-17T14:40:00Z",
  "data": {
    "assignment_id": 99999
  }
}

###############################################################################
# BULK SYNC - INITIAL CACHE POPULATION
###############################################################################

### 10. Bulk Sync Employees (Clear & Replace All)
POST {{bulkSyncEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "clearExisting": true,
  "data": [
    {
      "employeeNumber": "BULK-001",
      "firstName": "Alice",
      "middleName": "Ann",
      "lastName": "Anderson",
      "phone": "0999-111-1111",
      "position": "Driver",
      "departmentId": 1,
      "department": "Operations"
    },
    {
      "employeeNumber": "BULK-002",
      "firstName": "Bob",
      "middleName": "Bruce",
      "lastName": "Brown",
      "phone": "0999-222-2222",
      "position": "Conductor",
      "departmentId": 1,
      "department": "Operations"
    },
    {
      "employeeNumber": "BULK-003",
      "firstName": "Carol",
      "middleName": "Claire",
      "lastName": "Clark",
      "phone": "0999-333-3333",
      "position": "Mechanic",
      "departmentId": 2,
      "department": "Maintenance"
    }
  ]
}

### 11. Bulk Sync Payroll (Append)
POST {{bulkSyncEndpoint}}
Content-Type: application/json

{
  "source": "hr_payroll",
  "clearExisting": false,
  "data": [
    {
      "employeeNumber": "BULK-001",
      "firstName": "Alice",
      "middleName": "Ann",
      "lastName": "Anderson",
      "suffix": null,
      "employeeStatus": "ACTIVE",
      "hiredate": "2024-01-15",
      "terminationDate": null,
      "basicRate": "15000.00",
      "position": {
        "positionName": "Driver",
        "department": {
          "departmentName": "Operations"
        }
      },
      "attendances": [
        {
          "date": "2025-01-15",
          "status": "PRESENT"
        }
      ],
      "benefits": [
        {
          "value": "3000.00",
          "frequency": "MONTHLY",
          "effectiveDate": "2024-01-15",
          "endDate": null,
          "isActive": true,
          "benefitType": {
            "name": "Transportation Allowance"
          }
        }
      ],
      "deductions": []
    },
    {
      "employeeNumber": "BULK-002",
      "firstName": "Bob",
      "middleName": "Bruce",
      "lastName": "Brown",
      "suffix": null,
      "employeeStatus": "ACTIVE",
      "hiredate": "2024-02-01",
      "terminationDate": null,
      "basicRate": "12000.00",
      "position": {
        "positionName": "Conductor",
        "department": {
          "departmentName": "Operations"
        }
      },
      "attendances": [
        {
          "date": "2025-01-15",
          "status": "PRESENT"
        }
      ],
      "benefits": [
        {
          "value": "2000.00",
          "frequency": "MONTHLY",
          "effectiveDate": "2024-02-01",
          "endDate": null,
          "isActive": true,
          "benefitType": {
            "name": "Meal Allowance"
          }
        }
      ],
      "deductions": [
        {
          "type": "SSS",
          "value": "300.00",
          "frequency": "MONTHLY",
          "effectiveDate": "2024-02-01",
          "endDate": null,
          "isActive": true,
          "deductionType": {
            "name": "SSS Contribution"
          }
        }
      ]
    }
  ]
}

### 12. Bulk Sync Bus Trips (Replace All)
POST {{bulkSyncEndpoint}}
Content-Type: application/json

{
  "source": "op_bus_trips",
  "clearExisting": true,
  "data": [
    {
      "assignment_id": 10001,
      "bus_trip_id": 20001,
      "bus_route": "Cebu-Bohol",
      "is_revenue_recorded": false,
      "is_expense_recorded": false,
      "date_assigned": "2025-01-17",
      "trip_fuel_expense": "4000.00",
      "trip_revenue": "20000.00",
      "assignment_type": "BOUNDARY",
      "assignment_value": "7000.00",
      "payment_method": "CASH",
      "driver_name": "Alice Anderson",
      "conductor_name": "Bob Brown",
      "bus_plate_number": "DEF-5678",
      "bus_type": "REGULAR",
      "body_number": "BUS-BULK-001"
    },
    {
      "assignment_id": 10002,
      "bus_trip_id": 20002,
      "bus_route": "Manila-Davao",
      "is_revenue_recorded": true,
      "is_expense_recorded": true,
      "date_assigned": "2025-01-16",
      "trip_fuel_expense": "6000.00",
      "trip_revenue": "30000.00",
      "assignment_type": "HIRED",
      "assignment_value": "10000.00",
      "payment_method": "BANK",
      "driver_name": "Carol Clark",
      "conductor_name": "David Davis",
      "bus_plate_number": "GHI-9012",
      "bus_type": "DELUXE",
      "body_number": "BUS-BULK-002"
    }
  ]
}

###############################################################################
# ERROR HANDLING TESTS
###############################################################################

### 13. Invalid Source
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "invalid_source",
  "action": "INSERT",
  "timestamp": "2025-01-17T14:45:00Z",
  "data": {}
}

### 14. Invalid Action
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "INVALID_ACTION",
  "timestamp": "2025-01-17T14:50:00Z",
  "data": {}
}

### 15. Missing Required Fields
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "INSERT",
  "timestamp": "2025-01-17T14:55:00Z",
  "data": {
    "employeeNumber": "INVALID-001"
  }
}

### 16. Invalid Data Type
POST {{webhookEndpoint}}
Content-Type: application/json

{
  "source": "hr_employees",
  "action": "INSERT",
  "timestamp": "2025-01-17T15:00:00Z",
  "data": {
    "employeeNumber": "INVALID-002",
    "firstName": 12345,
    "lastName": true,
    "position": null,
    "departmentId": "not-a-number",
    "department": 999
  }
}

###############################################################################
# CLEANUP - Run after testing
###############################################################################

### 17. Cleanup - Delete Test Records (Run in database)
# DELETE FROM "EmployeeCache" WHERE "employeeNumber" LIKE 'TEST-%' OR "employeeNumber" LIKE 'BULK-%';
# DELETE FROM "PayrollCache" WHERE "employeeNumber" LIKE 'TEST-%' OR "employeeNumber" LIKE 'BULK-%';
# DELETE FROM "BusTripCache" WHERE "assignmentId" >= 10000;
